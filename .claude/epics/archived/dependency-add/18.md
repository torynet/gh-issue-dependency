---
name: Implement GitHub API integration for dependency creation
status: open
created: 2025-09-06T21:39:41Z
updated: 2025-09-06T21:45:33Z
github: https://github.com/torynet/gh-issue-dependency/issues/18
depends_on: [17]
parallel: false
conflicts_with: []
---

# Task: Implement GitHub API integration for dependency creation

## Description
Implement GitHub API integration for creating dependency relationships using POST operations to GitHub's dependency API endpoints. This includes error handling for rate limits, permissions, and network issues, with retry logic and proper integration with the validation engine.

## Acceptance Criteria
- [ ] GitHub API client setup using go-gh/v2 library for dependency creation
- [ ] POST operations for creating "blocked-by" and "blocks" relationships
- [ ] Integration with validation engine results and pre-flight checks
- [ ] Error handling for authentication, permissions, rate limiting, and network issues
- [ ] Retry logic with exponential backoff for transient failures
- [ ] Repository context handling for cross-repository dependencies
- [ ] API response parsing and success/failure determination
- [ ] Integration with existing GitHub API patterns from dependency-list

## Technical Details
- **Implementation approach**: Use GitHub's dependency API via go-gh/v2 with proper error handling and retry logic
- **Key considerations**: API rate limiting, error categorization, retry strategies
- **Code locations**: pkg/github.go (or similar), integration with validation engine

API endpoints to integrate:
```
POST /repos/{owner}/{repo}/issues/{issue_number}/dependencies/blocked_by
POST /repos/{owner}/{repo}/issues/{issue_number}/dependencies/blocking
```

Key functions to implement:
```go
type DependencyCreator struct {
    client *github.Client
    validator *ValidationPipeline
}

func (d *DependencyCreator) CreateRelationship(source, target IssueRef, relType string, dryRun bool) error {
    // Run validation first
    if err := d.validator.ValidateRelationship(source, target, relType); err != nil {
        return fmt.Errorf("validation failed: %w", err)
    }
    
    if dryRun {
        return nil // Skip actual creation
    }
    
    // Create the relationship
    switch relType {
    case "blocked-by":
        return d.createBlockedByRelationship(source, target)
    case "blocks":
        return d.createBlocksRelationship(source, target)
    default:
        return fmt.Errorf("unknown relationship type: %s", relType)
    }
}

func (d *DependencyCreator) createBlockedByRelationship(source, target IssueRef) error {
    endpoint := fmt.Sprintf("/repos/%s/%s/issues/%d/dependencies/blocked_by",
        source.Owner, source.Repo, source.Number)
    
    payload := map[string]interface{}{
        "blocked_by_issue_id": target.ID,
    }
    
    return d.makeAPICall(endpoint, payload)
}
```

Error handling categories:
- **Authentication errors**: "Run 'gh auth login' first"
- **Permission errors**: "Insufficient permissions to modify dependencies in OWNER/REPO"
- **Rate limit errors**: "API rate limit exceeded, retrying in X seconds"
- **Network errors**: "Network error, please check connection and retry"
- **API errors**: Specific GitHub API error messages with context

## Dependencies
- [ ] Task 002 completed (validation engine provides pre-flight checks)
- [ ] go-gh/v2 library available in go.mod
- [ ] GitHub CLI authentication configured
- [ ] Patterns from dependency-list for GitHub API integration

## Effort Estimate
- Size: M
- Hours: 2-3 hours
- Parallel: false (requires validation engine)

## Definition of Done
- [ ] API integration successfully creates dependency relationships
- [ ] Error handling covers all failure scenarios with proper categorization
- [ ] Retry logic handles transient failures appropriately
- [ ] Cross-repository dependencies are supported
- [ ] Integration with validation engine prevents invalid API calls
- [ ] API responses are properly parsed and validated
- [ ] Code follows existing GitHub API patterns from dependency-list
