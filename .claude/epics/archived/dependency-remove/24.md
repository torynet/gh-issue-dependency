---
name: Implement user safety features with confirmation prompts and dry run mode
status: open
created: 2025-09-06T22:11:58Z
updated: 2025-09-06T22:20:27Z
github: https://github.com/torynet/gh-issue-dependency/issues/24
depends_on: [23]
parallel: false
conflicts_with: []
---

# Task: Implement user safety features with confirmation prompts and dry run mode

## Description
Implement comprehensive user safety features including interactive confirmation prompts to prevent accidental deletions, dry run mode for previewing changes, and --force flag for automation scenarios. These features ensure users can safely manage dependency relationships with clear feedback and control.

## Acceptance Criteria
- [ ] Interactive confirmation prompt showing relationship details
- [ ] Dry run mode displays preview of what would be removed
- [ ] --force flag bypasses confirmation for automation use
- [ ] Confirmation prompt includes issue titles and relationship context
- [ ] Dry run output follows gh-sub-issue visual patterns
- [ ] Cancellation handling when user declines confirmation
- [ ] TTY detection for non-interactive environments
- [ ] Clear visual indicators for dry run vs actual operations

## Technical Details
- **Implementation approach**: Interactive prompts with clear visual feedback and dry run preview capability
- **Key considerations**: User experience, visual consistency, automation support
- **Code locations**: pkg/ui.go or pkg/confirmation.go, integration with cmd/remove.go

User interaction flows to implement:

**Confirmation Prompt**:
```text
Remove dependency relationship?
  Source: #123 - Feature: User Authentication System
  Target: #45 - Database migration setup  
  Type: blocked-by

This will remove the "blocked-by" relationship between these issues.
Continue? (y/N): 
```

**Dry Run Output**:
```text
Dry run: dependency removal preview

Would remove:
  ❌ blocked-by relationship: #123 ← #45 (Database migration setup)

No changes made. Use --force to skip confirmation or remove --dry-run to execute.
```

Key functions to implement:
```go
type ConfirmationPrompt struct {
    source   IssueRef
    target   IssueRef
    relType  string
    dryRun   bool
    force    bool
}

func (c *ConfirmationPrompt) ShowDryRun() error {
    fmt.Printf("Dry run: dependency removal preview\n\n")
    fmt.Printf("Would remove:\n")
    fmt.Printf("  ❌ %s relationship: %s\n", c.formatRelationship())
    fmt.Printf("\nNo changes made. Use --force to skip confirmation or remove --dry-run to execute.\n")
    return nil
}

func (c *ConfirmationPrompt) RequestConfirmation() (bool, error) {
    if c.force {
        return true, nil // Skip confirmation
    }
    
    fmt.Printf("Remove dependency relationship?\n")
    fmt.Printf("  Source: %s\n", c.formatIssue(c.source))
    fmt.Printf("  Target: %s\n", c.formatIssue(c.target))
    fmt.Printf("  Type: %s\n", c.relType)
    fmt.Printf("\nThis will remove the \"%s\" relationship between these issues.\n", c.relType)
    
    return c.promptYesNo("Continue? (y/N): ")
}
```

## Dependencies
- [ ] Task 002 completed (validation provides relationship details)
- [ ] Issue title fetching capability for rich prompts
- [ ] TTY detection for interactive vs non-interactive environments

## Effort Estimate
- Size: S
- Hours: 1-2 hours  
- Parallel: false (requires validation results)

## Definition of Done
- [ ] Confirmation prompts prevent accidental deletions effectively
- [ ] Dry run mode accurately shows what would be removed
- [ ] --force flag works correctly for automation scenarios
- [ ] Visual output matches gh-sub-issue patterns and quality
- [ ] Non-interactive environments handled gracefully
- [ ] User can cancel operations safely at any point
- [ ] All confirmation scenarios tested and working