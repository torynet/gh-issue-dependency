---
name: Implement relationship existence validation and permission checking
status: open
created: 2025-09-06T22:11:58Z
updated: 2025-09-06T22:20:27Z
github: https://github.com/torynet/gh-issue-dependency/issues/23
depends_on: [22]
parallel: false
conflicts_with: []
---

# Task: Implement relationship existence validation and permission checking

## Description
Implement comprehensive validation logic to verify that dependency relationships actually exist before attempting removal, and check that the user has proper permissions to modify relationships. This includes reusing validation patterns from dependency-add and dependency-list for consistency.

## Acceptance Criteria
- [ ] Relationship existence verification using GitHub API
- [ ] Permission checking for repository write access
- [ ] Issue accessibility validation for both source and target issues
- [ ] Integration with existing validation utilities from other dependency commands
- [ ] Proper error handling for non-existent relationships
- [ ] Proper error handling for permission denied scenarios
- [ ] Validation results provide clear feedback for user guidance
- [ ] Efficient API usage to minimize redundant calls

## Technical Details
- **Implementation approach**: Leverage existing validation patterns with new relationship existence checking
- **Key considerations**: API efficiency, clear error messages, permission validation
- **Code locations**: pkg/validation.go (or similar), integration with cmd/remove.go

Key validation functions to implement:
```go
type RemovalValidator struct {
    client *github.Client
    // Reuse existing validation components
}

func (v *RemovalValidator) ValidateRemoval(source, target IssueRef, relType string) error {
    // 1. Validate basic inputs
    if err := v.validateInputs(source, target, relType); err != nil {
        return fmt.Errorf("input validation failed: %w", err)
    }
    
    // 2. Check permissions
    if err := v.validatePermissions(source); err != nil {
        return fmt.Errorf("permission check failed: %w", err)
    }
    
    // 3. Verify issues exist and are accessible
    if err := v.validateIssueAccess(source, target); err != nil {
        return fmt.Errorf("issue access validation failed: %w", err)
    }
    
    return nil
}

func (v *RemovalValidator) VerifyRelationshipExists(source, target IssueRef, relType string) (bool, error) {
    // Query GitHub API to check if relationship exists
    relationships, err := v.client.GetIssueDependencies(source.Owner, source.Repo, source.Number)
    if err != nil {
        return false, fmt.Errorf("failed to fetch dependencies: %w", err)
    }
    
    return v.relationshipExistsInList(relationships, target, relType), nil
}
```

Error scenarios to handle:
- **Non-existent relationship**: "No blocked-by relationship found between #123 and #45"
- **Permission denied**: "Insufficient write permissions for repository owner/repo"
- **Issue not found**: "Issue #123 not found or not accessible"
- **API errors**: "GitHub API error: rate limit exceeded"

## Dependencies
- [ ] Task 001 completed (command structure provides input parsing)
- [ ] dependency-add validation patterns (for permission checking)
- [ ] dependency-list patterns (for relationship querying)
- [ ] GitHub API client setup

## Effort Estimate
- Size: M
- Hours: 2-3 hours
- Parallel: false (requires command structure)

## Definition of Done
- [ ] Relationship existence verification works correctly
- [ ] Permission checking prevents unauthorized removals
- [ ] All validation errors provide specific, actionable guidance
- [ ] Integration with existing validation utilities maintains consistency
- [ ] API calls are efficient and properly handle rate limits
- [ ] Validation results integrate with remove command flow
- [ ] Edge cases handled (cross-repository access, private repos, etc.)