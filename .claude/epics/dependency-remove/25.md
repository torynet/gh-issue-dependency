---
name: Implement GitHub API integration for dependency deletion
status: open
created: 2025-09-06T22:11:58Z
updated: 2025-09-06T22:20:27Z
github: https://github.com/torynet/gh-issue-dependency/issues/25
depends_on: [24]
parallel: false
conflicts_with: []
---

# Task: Implement GitHub API integration for dependency deletion

## Description
Implement the actual GitHub API integration for deleting dependency relationships using DELETE operations. This includes proper error handling, retry logic, and integration with the validation and confirmation systems to execute safe dependency removals.

## Acceptance Criteria
- [ ] GitHub API client setup for DELETE operations on dependency endpoints
- [ ] Integration with validation results and confirmation system
- [ ] DELETE operations for both "blocked-by" and "blocks" relationships
- [ ] Error handling for authentication, permissions, rate limiting, and network issues
- [ ] Retry logic with exponential backoff for transient failures
- [ ] Success confirmation with relationship details
- [ ] API response parsing and error categorization
- [ ] Integration with existing GitHub API patterns from other dependency commands

## Technical Details
- **Implementation approach**: Use GitHub's dependency deletion API via go-gh/v2 with comprehensive error handling
- **Key considerations**: API rate limiting, error categorization, retry strategies, success confirmation
- **Code locations**: pkg/github.go (or similar), integration with validation and confirmation systems

API endpoints to implement:
```
DELETE /repos/{owner}/{repo}/issues/{issue_number}/dependencies/{relationship_id}
```

Key functions to implement:
```go
type DependencyRemover struct {
    client    *github.Client
    validator *RemovalValidator
    ui        *ConfirmationPrompt
}

func (r *DependencyRemover) RemoveRelationship(source, target IssueRef, relType string, opts RemoveOptions) error {
    // 1. Run validation pipeline
    if err := r.validator.ValidateRemoval(source, target, relType); err != nil {
        return fmt.Errorf("validation failed: %w", err)
    }
    
    // 2. Verify relationship exists
    exists, err := r.validator.VerifyRelationshipExists(source, target, relType)
    if err != nil {
        return fmt.Errorf("failed to verify relationship: %w", err)
    }
    if !exists {
        return fmt.Errorf("relationship does not exist: %s %s %s", source, relType, target)
    }
    
    // 3. Handle dry run
    if opts.DryRun {
        return r.ui.ShowDryRun()
    }
    
    // 4. Get user confirmation
    if !opts.Force {
        confirmed, err := r.ui.RequestConfirmation()
        if err != nil || !confirmed {
            return fmt.Errorf("removal cancelled")
        }
    }
    
    // 5. Execute deletion
    if err := r.deleteRelationship(source, target, relType); err != nil {
        return fmt.Errorf("deletion failed: %w", err)
    }
    
    // 6. Show success confirmation
    return r.showSuccessMessage(source, target, relType)
}

func (r *DependencyRemover) deleteRelationship(source, target IssueRef, relType string) error {
    endpoint := fmt.Sprintf("/repos/%s/%s/issues/%d/dependencies", 
        source.Owner, source.Repo, source.Number)
    
    // Find specific relationship ID and delete it
    return r.executeDeleteWithRetry(endpoint, source, target, relType)
}
```

Error handling categories:
- **Authentication errors**: "GitHub authentication required. Run 'gh auth login'"
- **Permission errors**: "Insufficient permissions to modify dependencies in OWNER/REPO"  
- **Rate limit errors**: "API rate limit exceeded, retrying in X seconds"
- **Network errors**: "Network error, please check connection and retry"
- **Relationship not found**: "Dependency relationship no longer exists"

Success confirmation:
```text
✅ Removed blocked-by relationship: #123 ← #45 (Database migration setup)

Dependency removed successfully.
```

## Dependencies
- [ ] Task 003 completed (confirmation system provides user approval)
- [ ] go-gh/v2 library available in go.mod
- [ ] GitHub CLI authentication configured
- [ ] Existing GitHub API patterns from dependency-list and dependency-add

## Effort Estimate
- Size: M
- Hours: 2-3 hours
- Parallel: false (requires confirmation system)

## Definition of Done
- [ ] API integration successfully deletes dependency relationships
- [ ] All error scenarios handled with proper categorization and user guidance
- [ ] Retry logic handles transient failures appropriately
- [ ] Success confirmation provides clear feedback about what was removed
- [ ] Integration with validation and confirmation systems works seamlessly
- [ ] API responses properly parsed and validated
- [ ] Code follows existing GitHub API patterns from other dependency commands